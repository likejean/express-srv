<!DOCTYPE html>
<html>
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="stylesheet" href="../css/beaurify.css">
      <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" 
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
        crossorigin="anonymous">
      <link rel="stylesheet" 
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
      />
      <script 
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
        crossorigin="anonymous">
      </script>
      
      <title>Calibration Record</title>
    </head>
    <body>

      <div class="container-fluid">
        <div class="row d-flex justify-content-center">
          <div class="card border-success my-5" style="max-width: 35rem;">
            <div id="cardHeader" class="card-header bg-transparent border-success text-center">Calibration Summary</div>
    
    
            <div class="card-body text-success">
              <h5 class="card-title text-center"></h5>

              <div class="d-flex align-items-center">
                <div class="col-5">Calibratin Name:</div>               
                <div id="calNameWrapper" class="col-6"><span class="cal-notice-span" id="calName"></span></div>                
                <div class="p-2 col-1"><i id="calNameIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Calibration Last Date:</div>               
                <div id="lastCalDateWrapper" class="col-6"><span class="cal-notice-span" id="lastCalDate"></span></div>                
                <div class="p-2 col-1"><i id="lastCalDateIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Calibration Due Date:</div>
                <div id="dueCalDateWrapper" class="col-6"><span class="cal-notice-span" id="dueCalDate"></span></div>
                <div class="p-2 col-1"><i id="dueCalDateIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Calibration Extended:</div>
                <div id="calExtendedWrapper" class="col-6"><span class="cal-notice-span" id="calExtended"></span></div>
                <div class="p-2 col-1"><i id="calExtendedIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Maximum Calibration Extension:</div>
                <div id="maxCalExtentionWrapper" class="col-6"><span class="cal-notice-span" id="maxCalExtention"></span></div>
                <div class="p-2 col-1"><i id="maxCalExtentionIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Calibration Range Percent:</div>
                <div id="calRangePercentWrapper" class="col-6"><span class="cal-notice-span" id="calRangePercent"></span></div>
                <div class="p-2 col-1"><i id="calRangePercentIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Adjustment Made:</div>
                <div id="calAdjustmentMadeWrapper" class="col-6"><span class="cal-notice-span" id="calAdjustmentMade"></span></div>
                <div class="p-2 col-1"><i id="calAdjustmentMadeIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>

              <div class="d-flex align-items-center">
                <div class="col-5">Comment:</div>
                <div id="calCommentWrapper" class="col-6"><span class="cal-notice-span" id="calComment"></span></div>
                <div class="p-2 col-1"><i id="calCommentIcon" class="fa-duotone fa-solid fa-2x fa-circle-dot"></i></div>
              </div>
            
            </div>
    
    
            <div class="card-footer bg-transparent border-success text-center">
              <div class="container">
                <div class="row m-2">
                    <div class="form-group col text-center">                           
                        <button type="submit" class="btn btn-primary" onclick=patchCalibrationSummaryRecord()>Submit</button>
                        <a href="../index.html" class="btn btn-dark">Back</a>
                    </div>
                    
                </div>                    
            </div>
            </div>
          </div>
        </div>
      </div>
  

    </body>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
      integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
      crossorigin="anonymous"></script>    
    </script>

    <script src="../libs/moment.min.js"></script>
    <script src="../libs/moment-with-locales.min.js"></script>
    <script src="../js/calibration/fetchCalRecordById.js"></script>
    <script src="../js/utils/trimStringBySubstring.js"></script>
    <script src="../js/utils/removeAllChildNodes.js"></script>
    <script src="../js/collections/editCalContentItemActive.js"></script>


    <script>
     

      // Get the element you want to add the event listener to
      let icons = document.querySelectorAll('.fa-circle-dot');
      icons.forEach(icon => {
        icon.addEventListener('click', (e) => {

           const wrapperName = trimBySubstring(e.target.id, "Icon").concat("Wrapper")
             
           const wrapper = document.getElementById(wrapperName);
           const placeholderText = wrapper.textContent;
           let icon = document.getElementById(editCalContentItemActive[wrapperName].name.concat("Icon"));

            if(!editCalContentItemActive[wrapperName].status) { 
              let input = document.createElement('input');
              icon.classList.replace("fa-circle-dot", "fa-file-pen"); 
              editCalContentItemActive[wrapperName].childNodes = Array.from(wrapper.childNodes);        
              removeAllChildNodes(wrapper);                           
              editCalContentItemActive[wrapperName].status = true;              
              input.classList.add(editCalContentItemActive[wrapperName].class);
              input.setAttribute("name",  editCalContentItemActive[wrapperName].name);
              input.setAttribute("type", editCalContentItemActive[wrapperName].type);
              input.setAttribute("style", "border-color:blue;");
              
              wrapper.appendChild(input);
              input.addEventListener("input", inputValues);
            } else {                   
              removeAllChildNodes(wrapper);
              icon.classList.replace("fa-file-pen", "fa-circle-dot");
              editCalContentItemActive[wrapperName].status = false;
              wrapper.append(...editCalContentItemActive[wrapperName].childNodes);
              editCalContentItemActive[wrapperName].childNodes = [];              
            }
            
          });
      })


      function inputValues (event) {
          // Get the new value from the input field
          const newValue = event.target.value;
          const inputType = event.target.type;
          const concatInputName = event.target.name.concat("Wrapper");             
          if (inputType === "checkbox") editCalContentItemActive[concatInputName].checked = this.checked;
          else editCalContentItemActive[concatInputName].value = newValue;
        
      }

      function patchCalibrationSummaryRecord() {
        
        const filterAndTransform = (obj, filterFn) => {
            const result = {};

            for (const key in obj) {
              if (filterFn(obj[key])) {
                  obj[key].type == "checkbox" ? result[obj[key].databaseName]= obj[key].checked : result[obj[key].databaseName]= obj[key].value;                
                };
              }
              return result;
            }

          const filteredPatchRequestData = filterAndTransform(editCalContentItemActive, item => item.status === true);
      
        }

                  
      
    </script>


</html>
