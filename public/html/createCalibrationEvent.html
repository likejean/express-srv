<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/beaurify.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.1/dist/css/datepicker-bs5.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <title>New Calibration Form</title>
  </head>
  <body>
    <main>
      <div class="container">
        <div class="jumbotron pt-4">
          <h1 class="new-sensor-form-title">New Calibration</h1>
          <p>Please, use this form to log calibration event</p>
        </div>

        <form id="newCalibrationEvent">
          <!-- calibrations -->
          <!-- /////////////////////////////
                    ///////////////////////////// -->
          <div
            class="control-form-field-box d-flex align-items-start p-2 flex-column my-4"
          >
            <div class="container">
              <label for="calibrationListSelection"
                >Calibrations/Verifications Applied</label
              >
              <div class="row pb-5">
                <div class="col-lg-6 col-sm-12 mb-sm-4">
                  <select
                    name="calibrations"
                    class="form-select options-available"
                    aria-label="Please, select calibration procedures"
                    id="calibrationListSelection"
                    aria-describedby="calibrationsList#Help"
                  >
                    <option selected>Open this select menu</option>
                    <!-- The list of <option /> tags will be generated by Javascript code later -->
                    <!-- <option value="1">{0-500lbf}</option>
                                        <option value="2">{0-10000lbf}</option>
                                        <option value="3">{0-20000lbf}</option>
                                        <option value="4">{0-0.2in}</option> -->
                  </select>
                  <small
                    id="calibrationsList#Help"
                    class="form-text text-muted"
                  >
                    If calibration procedure is not included in this list,
                    please, navigate to calibration page and create one
                  </small>
                </div>
                <div class="col-lg-6 col-sm-12 mb-sm-4 text-center">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Calibration Name</th>
                        <th scope="col">Principle</th>
                      </tr>
                    </thead>
                    <tbody class="selected-calibration-list">
                      <!-- This where the <tbody /> is attached by Javascript dynamically-->
                    </tbody>
                  </table>
                  <button
                    id="clearCalibrationSelectionList"
                    class="btn btn-info"
                  >
                    CLear Table List
                  </button>
                </div>
              </div>

              <hr />
              <div class="row">
                <h2 class="calibrations-badge-tab"></h2>
              </div>

              <div>
                

                <hr />

                <div class="row">
                  <div class="col-lg-6 col-sm-12 m-auto">
                    <label for="lastDate">Calibration Last Date</label>
                    <input
                      name="calibrationLastDate"
                      id="lastDate"
                      class="form-control"
                      type="date"
                    />
                    <span id="lastDateSelected"></span>
                  </div>
                  <div class="col-lg-6 col-sm-12 m-auto">
                    <label for="dueDate">Calibration Due Date</label>
                    <input
                      name="calibrationDueDate"
                      id="dueDate"
                      class="form-control"
                      type="date"
                    />
                    <span id="dueDateSelected"></span>
                  </div>
                </div>

                <hr />

                <div class="row">
                  <div class="col-lg-4 col-sm-12 mb-sm-4">
                    <label
                      class="font-weight-bold"
                      for="maxCalibrationExtension"
                      >Maximum Extension Allowable</label
                    >
                    <input
                      name="maxCalibrationExtension"
                      type="text"
                      class="form-control"
                      id="maxCalibrationExtension"
                      aria-describedby="maxCalibrationExtension#Help"
                      placeholder=""
                      required
                    />
                    <small
                      id="maxCalibrationExtension#Help"
                      class="form-text text-muted"
                    >
                      Enter maximum allowable duration for this calibration
                      procedure
                    </small>
                  </div>

                  <div class="col-lg-4 col-sm-12 mb-sm-4">
                    <label
                      class="font-weight-bold"
                      for="calibrationRangePercent"
                      >Calibration Range Percentage</label
                    >
                    <input
                      name="calibrationRangePercent"
                      type="number"
                      class="form-control"
                      id="calibrationRangePercent"
                      aria-describedby="calibrationRangePercent#Help"
                      placeholder="100"
                      required
                    />
                    <small
                      id="calibrationRangePercent#Help"
                      class="form-text text-muted"
                    >
                      Please, enter calibrated range percentage.
                    </small>
                  </div>

                  <div class="col-lg-4 col-sm-12 mb-sm-4">
                    <div class="form-check mx-2">
                      <input
                        name="isCalibrationExtended"
                        class="form-check-input"
                        type="checkbox"
                        value=""
                        id="isCalibrationExtended"
                        aria-describedby="isCalibrationExtended#Help"
                      />
                      <label
                        id="new-sensor-extention"
                        class="form-check-label"
                        for="isCalibrationExtended"
                      >
                        Any calibration/verification extended for this sensor?
                      </label>
                    </div>
                    <small
                      id="isCalibrationExtended#Help"
                      class="form-text text-muted"
                    >
                      Check this box if, at least, one calibration extended for
                      this sensor. Further details regarding calibration status
                      of this sensor must be entered in comment section below.
                    </small>
                  </div>
                </div>

                <hr />

                
              </div>
            </div>
          </div>

          <div class="container">
            <div class="row m-5">
              <div class="form-group col text-center">
                <button type="submit" class="btn btn-primary">Submit</button>
                <a href="../index.html" class="btn btn-dark">Back</a>
              </div>
            </div>
          </div>

          <!-- /////////////////////////////
                    ///////////////////////////// -->
          `
        </form>
      </div>
    </main>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
      integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
      crossorigin="anonymous"
    ></script>
    
    <script src="../js/utils/createTableCell.js"></script>
    <script src="../js/utils/removeAllChildNodes.js"></script>
    <script src="../js/classes/calibrationProceduresClass.js"></script>

    <script>
      const tableBody = document.querySelector(".selected-calibration-list");
      const optionsAvailable = document.querySelector(".options-available");
      const clearSelectionButton = document.getElementById(
        "clearCalibrationSelectionList"
      ); // select the button element
      let selectedCals = {};

      let data = JSON.parse(window.localStorage.getItem("calibrations"));

      data.forEach((item, idx) => {
        let option = document.createElement("option");
        let text = document.createTextNode(item.calibrationName);
        selectedCals[`${idx + 1}`] = new calibrationlProcedure(
          item._id,
          item.calibrationName,
          item.calibrationRangePercent
        );
        option.setAttribute("value", idx + 1);
        option.appendChild(text);
        optionsAvailable.appendChild(option);
      });
      clearSelectionButton.style.visibility = "hidden";
      // submit form

      document
        .querySelector("#calibrationListSelection")
        .addEventListener("change", function (e) {
          let name = e.target.options[e.target.selectedIndex].text;
          let val = e.target.value;
          let row = document.createElement("tr");
          row.setAttribute("id", `row${val}`);
          row.appendChild(createTableCell(`${val}`, []));
          row.appendChild(
            createTableCell(`${selectedCals[val].procedureName}`, [])
          );
          row.appendChild(
            createTableCell(`${selectedCals[val].calibrationPrinciple}`, [])
          );
          clearSelectionButton.style.visibility = "visible";
          tableBody.appendChild(row);
        });

      clearSelectionButton.addEventListener("click", (e) => {
        // add a click event listener
        e.preventDefault();
        removeAllChildNodes(tableBody);
        clearSelectionButton.style.visibility = "hidden";
      });

      function getFormValues() {
        // Get the form element
        const form = document.getElementById("newCalibrationEvent");

        // Get the input values
        const EID = form.elements["EID"].value;
        console.log(form.elements);
        //const email = form.elements["email"].value;

        // Do something with the values (e.g., display them)
        console.log("Name:", EID);
        //console.log("Email:", email);
      }
    </script>
  </body>
</html>
