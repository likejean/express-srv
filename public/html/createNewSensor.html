<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />   
    <link rel="stylesheet" href="../css/beaurify.css">
    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
      rel="stylesheet" 
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
      crossorigin="anonymous">
    <link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
    />
    <script 
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
      crossorigin="anonymous">
    </script> 
    <title>New Sensor Form</title>
  </head>
  <body>
    <nav>
      <div class="nav-center">
        
      </div>
    </nav>
    <main>
        <div class="container container-sm">
            <div class="jumbotron  pt-4">
                <h1>New Sensor</h1>      
                <p>Please, use this form to create a new sensor</p>
            </div>
          <form>

            <!-- EID -->
            <div id="control-form-field-box" class="form-group my-4 p-2">
              <label for="sensorEID">Sensor EID</label>
              <input type="text" class="form-control" id="sensorEID" aria-describedby="sensorEID#Help" placeholder="Enter EID#" required>
              <small id="sensorEID#Help" class="form-text text-muted">
                Please, do not include any characters, empty spaces or zeros preceding numbers. 
                Correct format example: EID1, EID123. Incorrect format example: EID001, "EID001" or EID 001
              </small>
            </div>

            <!-- description -->
            <div id="control-form-field-box" class="form-group my-4 p-2">
              <label class="font-weight-bold" for="sensorDescription">Sensor Description</label>
              <input type="text" class="form-control" id="sensorDescription" aria-describedby="sensorDescription#Help"  placeholder="Enter sensor's description" required>
              <small id="isensorDescription#Help" class="form-text text-muted">
                Description must be very as short as possible (examples: "deflectometer", "load transducer", ext.)
                Further details regarding this device must be entered in comment section below.
              </small>
            </div>


            <!-- calibrationExtended -->
            <div id="control-form-field-box" class="form-check p-2 d-flex align-items-start flex-column my-4">
              <label for="isCalibrationExtended">Calibration Extension Status</label>
              <div>
                <input type="checkbox" class="form-check-input mx-auto" id="isCalibrationExtended" aria-describedby="isCalibrationExtended#Help">
                <p id="new-sensor-extention" class="form-check-label mx-4" for="isCalibrationExtended">Any calibration/verification extended for this sensor?</p>
              </div> 
              <div>
                <small id="isCalibrationExtended#Help" class="form-text text-muted">
                  Check this box if, at least, one calibration extended for this sensor. 
                  Further details regarding calibration status of this sensor must be entered in comment section below.
                </small>
              </div> 
            </div>

            <!-- calibrations -->
            <div id="control-form-field-box" class="d-flex align-items-start p-2 flex-column my-4">
                <div class="container">
                    <label for="calibrationListSelection">Calibrations/Verifications Applied</label>
                    <div class="row">
                        <div class="col-12 col-lg-8">
                            <select 
                                class="form-select options-available" 
                                aria-label="Please, select calibration procedures" 
                                id="calibrationListSelection" 
                                aria-describedby="calibrationsList#Help">             
                                <option selected>Open this select menu</option>

                                <!-- The list of <option /> tags will be generated by Javascript code later -->

                                <!-- <option value="1">{0-500lbf}</option>
                                <option value="2">{0-10000lbf}</option>
                                <option value="3">{0-20000lbf}</option>
                                <option value="4">{0-0.2in}</option> -->
                            </select>
                           
                        </div>
                        <div class="col-4 d-none d-lg-table-cell">
                            <table class="table table-hover selected-calibration-list">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Calibration Name</th>
                                        <th scope="col">Principle</th>
                                    </tr>
                                </thead>
                                <!-- This where the <tbody /> is attached by Javascript -->
                                
                            </table>
                            <button class="btn btn-info">CLear Table List</button>
                        </div>
                    </div>
                    <small id="calibrationsList#Help" class="form-text text-muted">
                        If calibration procedure is not included in this list, please, navigate to calibration page and create one
                    </small>
                </div>              
            </div>


             <!-- type -->
             <div id="control-form-field-box" class="d-flex align-items-start p-2 flex-column my-4">
              
                <div class="container">
                <label for="sensorTypeSelection">Sensor Type</label>              
                    <div class="row">
                        <div class="col-6">
                            <select class="form-select options-available" aria-label="Please, select sensor type below" id="sensorTypeSelection" aria-describedby="sensorTypeSelection#Help">             
                                <option selected>Open this select menu</option>
                                <!-- The list of <option /> tags will be generated by Javascript code later -->
                                <option value="1">T Thermocouple</option>
                                <option value="2">Whitestone Bridge</option>
                                <option value="3">Other</option>
                            </select>
                        </div>              
                        <div class="col-6">
                            
                        </div>
                    </div>
                    <small id="sensorTypeSelection#Help" class="form-text text-muted">
                        If sensor type not included in this list, please, select other
                    </small>
                </div>
              
              
             
            </div>
            




            <button type="submit" class="btn btn-primary">Submit</button>
            <a href="../index.html" class="btn btn-primary btn-sm">Back</a>
          </form>        
        </div>
        
    </main>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
      integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
      crossorigin="anonymous"
    ></script>  
    <script src="../js/utils/createTableCell.js"></script>

    <script>
       
       const tableBody = document.createElement("tbody");
       const optionsAvailable = document.querySelector('.options-available');
       const optionsTable = document.querySelector('.selected-calibration-list');
       const calsObj = {};
        
  
        const fetchCalibrationProcedures = async () => {
          try {
            const { data } = await axios.get('/api/calibrations');

            data.payload.forEach((item, idx) => {
                let option = document.createElement("option"); 
                calsObj[`${idx+1}`]={procedureName: item.procedureName, calibrationPrinciple: item.calibrationPrinciple}      
                option.setAttribute('value', idx + 1);
                let text = document.createTextNode(item.procedureName);
                option.appendChild(text);      
                optionsAvailable.appendChild(option);
            });

            } catch (error) {
                console.log('no data fetched')
            }
        }
        fetchCalibrationProcedures()
        // submit form


        document.querySelector('#calibrationListSelection').addEventListener("change", function(e) {
            const name = e.target.options[e.target.selectedIndex].text;
           
            let row = document.createElement("tr");       
            row.setAttribute('id', `row${e.target.value}`);
            row.appendChild(createTableCell(`${e.target.value}`,[]));
            row.appendChild(createTableCell(`${calsObj[e.target.value].procedureName}`,[]));
            row.appendChild(createTableCell(`${calsObj[e.target.value].calibrationPrinciple}`,[]));
            tableBody.appendChild(row);
            optionsTable.appendChild(tableBody);

        });
        
      </script>
  </body>
</html>