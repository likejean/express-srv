<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />   
    <link rel="stylesheet" href="../css/beaurify.css">
    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
      rel="stylesheet" 
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
      crossorigin="anonymous">
    <link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.1/dist/css/datepicker-bs5.min.css">
    <script 
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
      crossorigin="anonymous">
    </script> 
    <title>New Sensor Form</title>
  </head>
  <body>
    <nav>
      <div class="nav-center">
        
      </div>
    </nav>
    <main>
        <div class="container">

            <div class="jumbotron  pt-4">
                <h1 class="new-sensor-form-title">New Sensor</h1>      
                <p>Please, use this form to create a new sensor</p>
            </div>

            <form id="newSensorForm">
                <!-- EID -->
                <div id="control-form-field-box" class="form-group my-4 p-2">
                    <div class="container">
                        <label for="sensorEID">Sensor EID</label>
                        <input name="EID" type="text" class="form-control" id="sensorEID" aria-describedby="sensorEID#Help" placeholder="Enter EID#" required>
                        <small id="sensorEID#Help" class="form-text text-muted">
                            Please, do not include any characters, empty spaces or zeros preceding numbers. 
                            Correct format example: EID1, EID123. Incorrect format example: EID001, "EID001" or EID 001
                        </small>
                    </div>              
                </div>


                <!-- type and manufacturer -->
                <div id="control-form-field-box" class="form-group my-4 p-2">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="sensorType">Sensor Type</label>
                                <input type="text" class="form-control" id="sensorType" aria-describedby="sensorType#Help"  placeholder="" required>
                                <small id="sensorType#Help" class="form-text text-muted">
                                    Examples: Displacement Sensors, Temperature Sensors, Pressure Sensors, Laser Sensors, ext.
                                </small>
                            </div>
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="sensorManufacturer">Sensor Manufacturer</label>
                                <input type="text" class="form-control" id="sensorManufacturer" aria-describedby="sensorManufacturer#Help"  placeholder="" required>
                                <small id="sensorManufacturer#Help" class="form-text text-muted">
                                    Please, enter manufacturer name. (Example: Epsilon, Interface, MTS, ext.)
                                </small>
                            </div>
                        </div>
                    </div>              
                </div>

                <!-- description and model -->
                <div id="control-form-field-box" class="form-group my-4 p-2">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="sensorDescription">Sensor Description</label>
                                <input type="text" class="form-control" id="sensorDescription" aria-describedby="sensorDescription#Help"  placeholder="Please, enter sensor's description here" required>
                                <small id="sensorDescription#Help" class="form-text text-muted">
                                    Description must be very as short as possible (examples: "deflectometer", "load transducer", ext.)
                                    Further details regarding this device must be entered in comment section below.
                                </small>
                            </div>
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="sensorModel">Sensor Model</label>
                                <input type="text" class="form-control" id="sensorModel" aria-describedby="sensorModel#Help"  placeholder="Please, enter model abbrivation here" required>
                                <small id="sensorModel#Help" class="form-text text-muted">
                                    Model description must be as short as possible
                                </small>
                            </div>
                        </div>
                    </div>              
                </div>


                <!-- capacity and quantity -->
                <div id="control-form-field-box" class="form-group my-4 p-2">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="sensorCapacity">Sensor Capacity Range</label>
                                <input type="text" class="form-control" id="sensorCapacity" aria-describedby="sensorCapacity#Help"  placeholder="Please, enter sensor's capacity here" required>
                                <small id="sensorCapacity#Help" class="form-text text-muted">
                                    Sensor capacity must include measurement units. Please, do not include blank spaces between 
                                    capacity value and unit description. Further details regarding this device must be entered in comment section below.
                                </small>
                            </div>
                            <div class="col-lg-6 col-sm-12 mb-sm-4 mb-3">                           
                                
                                <label class="font-weight-bold" for="sensorQuantity">Measurement Quantity</label>
                                <input type="text" class="form-control" id="sensorQuantity" aria-describedby="sensorQuantity#Help"  placeholder="Please, enter measurement quantity for sensor here" required>
                                                        
                            </div>
                        </div>
                    </div>              
                </div>


                <!-- Comments -->
                <div id="control-form-field-box" class="form-check p-2 d-flex align-items-start flex-column my-4">
                    <div class="container">  
                        <div class="row">
                            <div class="form-group">
                                <label for="commentTextArea">Comments</label>
                                <textarea class="form-control" id="commentTextArea" rows="5"></textarea>
                            </div>
                        </div>
                    </div>
                </div>




                <!-- calibrations -->
                <!-- /////////////////////////////
                ///////////////////////////// -->
                <div id="control-form-field-box" class="d-flex align-items-start p-2 flex-column my-4">
                    <div class="container">
                        <label for="calibrationListSelection">Calibrations/Verifications Applied</label>
                        <div class="row pb-5">
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <select 
                                    class="form-select options-available" 
                                    aria-label="Please, select calibration procedures" 
                                    id="calibrationListSelection" 
                                    aria-describedby="calibrationsList#Help">             
                                    <option selected>Open this select menu</option>
                                    <!-- The list of <option /> tags will be generated by Javascript code later -->
                                    <!-- <option value="1">{0-500lbf}</option>
                                    <option value="2">{0-10000lbf}</option>
                                    <option value="3">{0-20000lbf}</option>
                                    <option value="4">{0-0.2in}</option> -->
                                </select>
                                <small id="calibrationsList#Help" class="form-text text-muted">
                                    If calibration procedure is not included in this list, please, navigate to calibration page and create one
                                </small>
                            </div>
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Calibration Name</th>
                                            <th scope="col">Principle</th>
                                        </tr>
                                    </thead>
                                    <tbody class="selected-calibration-list">
                                        <!-- This where the <tbody /> is attached by Javascript dynamically-->
                                    </tbody> 
                                </table>
                                <button id="clearCalibrationSelectionList" class="btn btn-info">CLear Table List</button>
                            </div>                       
                        </div>

                        <hr>
                        <div class="row">                        
                            <h2 class="calibrations-badge-tab">
                            </h2>
                        </div>


                        <div class="row">
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label for="calibrationFrequency">Calibration Frequency</label>  
                                <select class="form-select" aria-label="Please, select calibration/verfication frequency below" id="calibrationFrequency" aria-describedby="calibrationFrequency#Help">             
                                    <option selected>Open this select menu</option>
                                    <!-- The list of <option /> tags will be generated by Javascript code later -->
                                    <option value="1">Weekly</option>
                                    <option value="2">Biweekly</option>
                                    <option value="3">Monthly</option>
                                    <option value="4">Weekly</option>
                                    <option value="5">Quarterly</option>
                                    <option value="6">Semiannually</option>
                                    <option value="7">Annually</option>   
        
                                </select>
                                <small id="calibrationFrequency#Help" class="form-text text-muted">
                                    Please, select how frequently this sensor must be performed
                                </small>
                            </div>              
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label for="calibrationPriority">Calibration Priority</label>  
                                <select class="form-select" aria-label="Please, select calibration/verfication frequency below" id="calibrationPriority" aria-describedby="calibrationPriority#Help">             
                                    <option selected>Open this select menu</option>
                                    <!-- The list of <option /> tags will be generated by Javascript code later -->
                                    
                                    <option value="1">Mandatory</option>
                                    <option value="2">Optional</option>
                                    <option value="3">Unserviceable</option>
                                    <option value="3">Broken</option> 
                                </select>
                                <small id="calibrationPriority#Help" class="form-text text-muted">
                                    Please, select priority calibration level on this sensor
                                </small>
                            </div>
                        </div>

                        <hr>


                        <div class="row">
                            <div class="col-lg-6 col-sm-12 m-auto">
                                <label for="lastDate">Calibration Last Date</label>
                                <input id="lastDate" class="form-control" type="date" />
                                <span id="lastDateSelected"></span>
                            </div>
                            <div class="col-lg-6 col-sm-12 m-auto">
                                <label for="dueDate">Calibration Due Date</label>
                                <input id="dueDate" class="form-control" type="date" />
                                <span id="dueDateSelected"></span>
                            </div>
                        </div>

                        <hr>

                        <div class="row">
                                                    
                            <div class="col-lg-4 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="maxCalibrationExtension">Maximum Extension Allowable</label>
                                <input type="text" class="form-control" id="maxCalibrationExtension" aria-describedby="maxCalibrationExtension#Help"  placeholder="" required>
                                <small id="maxCalibrationExtension#Help" class="form-text text-muted">
                                    Enter maximum allowable duration for this calibration procedure
                                </small>
                            </div>
                            

                            <div class="col-lg-4 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="calibrationRangePercent">Calibration Range Percentage</label>
                                <input type="number" class="form-control" id="calibrationRangePercent" aria-describedby="calibrationRangePercent#Help"  placeholder="100" required>
                                <small id="calibrationRangePercent#Help" class="form-text text-muted">
                                    Please, enter calibrated range percentage.
                                </small>
                            </div>

                            <div class="col-lg-4 col-sm-12 mb-sm-4">
                                <div class="form-check mx-2">
                                    <input class="form-check-input" type="checkbox" value="" id="isCalibrationExtended" aria-describedby="isCalibrationExtended#Help">
                                    <label id="new-sensor-extention" class="form-check-label" for="isCalibrationExtended">
                                        Any calibration/verification extended for this sensor?
                                    </label>
                                    
                                </div>
                                <small id="isCalibrationExtended#Help" class="form-text text-muted">
                                    Check this box if, at least, one calibration extended for this sensor. 
                                    Further details regarding calibration status of this sensor must be entered in comment section below.
                                </small>
                            </div>
                                
                        </div>


                        <hr>

                        <div class="row">
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="calibratedBy">Calibrated By</label>
                                <input type="text" class="form-control" id="calibratedBy" aria-describedby="calibratedBy#Help"  placeholder="Intec">
                                <small id="calibratedByn#Help" class="form-text text-muted">
                                    Enter either Intec (if device was calibrated on site) or name of contractor permorming this calibration
                                </small>
                            </div>
                            <div class="col-lg-6 col-sm-12 mb-sm-4">
                                <label class="font-weight-bold" for="calibrationLocation">Calibration Location</label>
                                <input type="text" class="form-control" id="calibrationLocation" aria-describedby="calibrationLocation#Help"  placeholder="" required>
                                <small id="calibrationLocation#Help" class="form-text text-muted">
                                    Enter on which test frame was calibration performed (if applicable)
                                </small>
                            </div>
                        </div>
                    
                    </div>              
                </div>
            

                <!-- /////////////////////////////
                ///////////////////////////// -->

                <div class="container">
                    <div class="row m-5">

                        <div class="form-group col text-center">
                           
                            <button type="submit" class="btn btn-primary" onclick="getFormValues()">Submit</button>
                            <a href="../index.html" class="btn btn-dark">Back</a>
                        </div>
                        
                    </div>                    
                </div>

                
            </form>        
        </div>
        
    </main>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
      integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
      crossorigin="anonymous"
    ></script>  
    <script src="../js/utils/createTableCell.js"></script>
    <script src="../js/utils/removeAllChildNodes.js"></script>
    <script src="../js/classes/calibrationProceduresClass.js"></script>

    <script>
       
       const tableBody = document.querySelector('.selected-calibration-list');
       const optionsAvailable = document.querySelector('.options-available');
       const clearSelectionButton = document.getElementById('clearCalibrationSelectionList'); // select the button element
       
       let selectedCals = {};
        
  
        const fetchCalibrationProcedures = async () => {
          try {
            const { data } = await axios.get('/api/calibrations');

            data.payload.forEach((item, idx) => {
                let option = document.createElement("option"); 
                let text = document.createTextNode(item.procedureName);
                selectedCals[`${idx + 1}`] = new calibrationlProcedure(item._id, item.procedureName, item.calibrationPrinciple)      
                option.setAttribute('value', idx + 1);                
                option.appendChild(text);  
                optionsAvailable.appendChild(option);                
            });

            } catch (error) {                
                formAlert.textContent = error.response.data.msg;                
            }
        }
        fetchCalibrationProcedures()
        // submit form


        document.querySelector('#calibrationListSelection').addEventListener("change", function(e) {
            let name = e.target.options[e.target.selectedIndex].text;
            let val = e.target.value;
            let row = document.createElement("tr");       
            row.setAttribute('id', `row${val}`);
            row.appendChild(createTableCell(`${val}`,[]));
            row.appendChild(createTableCell(`${selectedCals[val].procedureName}`,[]));
            row.appendChild(createTableCell(`${selectedCals[val].calibrationPrinciple}`,[]));
            tableBody.appendChild(row);           

        });
        
        clearSelectionButton.addEventListener('click', (e) => { // add a click event listener
            e.preventDefault();            
            removeAllChildNodes(tableBody);
        });


        function getFormValues() {
            // Get the form element
            const form = document.getElementById("newSensorForm");

            // Get the input values
            const EID = form.elements["EID"].value;
            console.log(form.elements)
            //const email = form.elements["email"].value;

            // Do something with the values (e.g., display them)
            console.log("Name:", EID);
            //console.log("Email:", email);
        }

       
        
      </script>
  </body>
</html>